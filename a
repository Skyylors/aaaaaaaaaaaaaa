import requests
import time
import random
from stem import Signal
from stem.control import Controller

# Configuration
URL_CIBLE = "https://bit.ly/3M3jDIA"
OBJECTIF = 100

def changer_ip():
    try:
        with Controller.from_port(port=9051) as controller:
            controller.authenticate()
            controller.signal(Signal.NEWNYM)
            time.sleep(5) # Temps pour que le circuit Tor change
            return True
    except Exception as e:
        print(f"‚ùå Erreur Tor (Service lanc√© ?): {e}")
        return False

def clic_via_tor(session, n):
    # socks5h permet de faire passer aussi les requ√™tes DNS par Tor
    proxies = {
        'http': 'socks5h://127.0.0.1:9050',
        'https': 'socks5h://127.0.0.1:9050'
    }
    headers = {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0'}
    
    try:
        r = session.get(URL_CIBLE, proxies=proxies, headers=headers, timeout=15)
        if r.status_code == 200:
            print(f"‚úÖ [{n}/{OBJECTIF}] Clic r√©ussi !")
            return True
    except:
        print(f"‚ùå [{n}/{OBJECTIF}] √âchec (N≈ìud Tor lent)")
    return False

# Execution
print("üî• Bot de classement lanc√© sur Kali...")
success = 0
with requests.Session() as s:
    while success < OBJECTIF:
        if changer_ip():
            if clic_via_tor(s, success + 1):
                success += 1
            # Pause pour √™tre discret (important !)
            time.sleep(random.uniform(5, 10))
