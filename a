#!/usr/bin/env python3
"""
Script de rotation IP avec Tor - OptimisÃ© pour Kali Linux
"""

import requests
import time
from stem import Signal
from stem.control import Controller
from datetime import datetime

# ===== CONFIGURATION =====
URL = "METTEZ_LE_LIEN_DE_VOTRE_PROF_ICI"  # âš ï¸ MODIFIEZ CETTE LIGNE
MAX_CLICS = 100
PAUSE_ENTRE_CLICS = 2

# Configuration Tor
TOR_PROXY = {
    'http': 'socks5://127.0.0.1:9050',
    'https': 'socks5://127.0.0.1:9050'
}

def get_current_ip():
    """RÃ©cupÃ¨re l'IP actuelle via Tor"""
    try:
        response = requests.get('http://httpbin.org/ip', proxies=TOR_PROXY, timeout=10)
        return response.json()['origin']
    except:
        return "Erreur"

def renew_tor_ip():
    """Change l'identitÃ© Tor pour obtenir une nouvelle IP"""
    try:
        with Controller.from_port(port=9051) as controller:
            controller.authenticate()
            controller.signal(Signal.NEWNYM)
            time.sleep(3)
        return True
    except Exception as e:
        print(f"âš ï¸ Erreur renouvellement: {e}")
        return False

def faire_clic():
    """Effectue un clic sur l'URL cible"""
    try:
        response = requests.get(URL, proxies=TOR_PROXY, timeout=15)
        return response.status_code == 200
    except:
        return False

# ===== PROGRAMME PRINCIPAL =====
print("ğŸ§… SCRIPT TOR - KALI LINUX")
print("="*60)

if URL == "METTEZ_LE_LIEN_DE_VOTRE_PROF_ICI":
    print("âŒ ERREUR: Modifiez l'URL dans le script!")
    exit(1)

# VÃ©rification Tor
print("ğŸ” VÃ©rification Tor...", end=" ")
ip = get_current_ip()
if ip == "Erreur":
    print("âŒ")
    print("\nâš ï¸ Tor ne fonctionne pas!")
    print("VÃ©rifiez : sudo systemctl status tor")
    exit(1)
else:
    print(f"âœ… IP: {ip}")

# Test renouvellement
print("ğŸ”„ Test rotation IP...", end=" ")
if renew_tor_ip():
    new_ip = get_current_ip()
    if new_ip != ip:
        print(f"âœ… Nouvelle IP: {new_ip}")
    else:
        print("âš ï¸ IP inchangÃ©e (normal parfois)")
else:
    print("âŒ")

print("\n" + "="*60)
print(f"ğŸ¯ Objectif: {MAX_CLICS} clics")
print(f"ğŸŒ URL: {URL}")
print("="*60)

input("\nâ–¶ï¸  Appuyez sur EntrÃ©e pour dÃ©marrer...")

# Boucle principale
compteur_succes = 0
compteur_echecs = 0
ips_utilisees = set()
debut = datetime.now()

print("\nğŸš€ DÃ©marrage...\n")

for i in range(1, MAX_CLICS * 2):
    if compteur_succes >= MAX_CLICS:
        break
    
    ip_actuelle = get_current_ip()
    ips_utilisees.add(ip_actuelle)
    
    print(f"[{compteur_succes}/{MAX_CLICS}] ğŸ”„ Clic #{i} (IP: {ip_actuelle})...", end=" ", flush=True)
    
    if faire_clic():
        compteur_succes += 1
        print(f"âœ… OK (Total: {compteur_succes})")
    else:
        compteur_echecs += 1
        print("âŒ Ã‰CHEC")
    
    if compteur_succes >= MAX_CLICS:
        break
    
    print(f"   ğŸ”„ Rotation IP...", end=" ", flush=True)
    if renew_tor_ip():
        print("âœ…")
    else:
        print("âš ï¸")
    
    time.sleep(PAUSE_ENTRE_CLICS)

# RÃ©sumÃ©
duree = (datetime.now() - debut).total_seconds()

print("\n" + "="*60)
print("ğŸ“Š RÃ‰SULTATS")
print("="*60)
print(f"âœ… Clics rÃ©ussis : {compteur_succes}")
print(f"âŒ Ã‰checs        : {compteur_echecs}")
print(f"ğŸŒ IPs uniques   : {len(ips_utilisees)}")
print(f"â±ï¸  DurÃ©e         : {int(duree//60)}m {int(duree%60)}s")
print("="*60)

if compteur_succes >= MAX_CLICS:
    print("\nğŸ‰ MISSION ACCOMPLIE! ğŸ‰")
else:
    print(f"\nâš ï¸ Seulement {compteur_succes}/{MAX_CLICS} clics")

print(f"\nğŸ“‹ {len(ips_utilisees)} IPs utilisÃ©es:")
for idx, ip in enumerate(sorted(ips_utilisees)[:10], 1):
    print(f"   {idx}. {ip}")
if len(ips_utilisees) > 10:
    print(f"   ... et {len(ips_utilisees)-10} autres")
